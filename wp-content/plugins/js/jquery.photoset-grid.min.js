!function(a,b,c,d){"use strict";function g(b,c){this.element=b,this.options=a.extend({},f,c),this._defaults=f,this._name=e,this.init()}var e="photosetGrid",f={width:"100%",gutter:"0px",highresLinks:!1,lowresWidth:500,rel:"",onInit:function(){},onComplete:function(){}};g.prototype={init:function(){this.options.onInit(),this._setupRows(this.element,this.options),this._setupColumns(this.element,this.options)},_callback:function(){this.options.onComplete()},_setupRows:function(b,c){if(c.layout)this.layout=c.layout;else if(a(b).attr("data-layout"))this.layout=a(b).attr("data-layout");else{for(var d="",e=1,f=0;f<a(b).find("img").length;f++)d+=e.toString();this.layout=d}this.rows=this.layout.split("");for(var g in this.rows)this.rows[g]=parseInt(this.rows[g],10);var h=a(b).find("img"),i=0;a.each(this.rows,function(a,b){var c=i,d=i+b;h.slice(c,d).wrapAll('<div class="photoset-row cols-'+b+'"></div>'),i=d}),a(b).find(".photoset-row:not(:last-child)").css({"margin-bottom":c.gutter})},_setupColumns:function(c,d){var e=this,f=function(){function n(){var b=a(c).width().toString();b!==a(c).attr("data-width")&&(e.each(function(){var b=a(this).find("img:eq(0)");a(this).find("img").each(function(){var c=a(this);c.height()<b.height()&&(b=a(this)),c.width()>d.lowresWidth&&c.attr("data-highres")&&c.attr("src",c.attr("data-highres"))});var c=b.height(),e=Math.floor(.025*c);a(this).height(c-e),a(this).find("img").each(function(){var b=.5*(c-a(this).height())+"px";a(this).css({"margin-top":b})})}),a(c).attr("data-width",b))}var e=a(c).find(".photoset-row"),f=a(c).find("img");d.highresLinks?(f.each(function(){var b;b=a(this).attr("data-highres")?a(this).attr("data-highres"):a(this).attr("src"),a(this).wrapAll('<a href="'+b+'" class="photoset-cell highres-link" />')}),d.rel&&f.parent().attr("rel",d.rel)):f.each(function(){a(this).wrapAll('<div class="photoset-cell" />')});var g=a(c).find(".photoset-cell"),h=a(c).find(".cols-1 .photoset-cell"),i=a(c).find(".cols-2 .photoset-cell"),j=a(c).find(".cols-3 .photoset-cell"),k=a(c).find(".cols-4 .photoset-cell"),l=a(c).find(".cols-5 .photoset-cell");a(c).css({width:d.width}),e.css({clear:"left",display:"block",overflow:"hidden"}),g.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),f.css({width:"100%",height:"auto"}),h.css({width:"100%"}),i.css({width:"50%"}),j.css({width:"33.3%"}),k.css({width:"25%"}),l.css({width:"20%"});var m=parseInt(d.gutter,10);a(c).find(".photoset-cell:not(:last-child)").css({"padding-right":m/2+"px"}),a(c).find(".photoset-cell:not(:first-child)").css({"padding-left":m/2+"px"}),n(),a(b).on("resize",function(){n()})};a(c).imagesLoaded(function(){f(),e._callback()})}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})};var h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(b){function l(){var d=a(j),f=a(k);e&&(k.length?e.reject(g,d,f):e.resolve(g)),a.isFunction(b)&&b.call(c,g,d,f)}function m(a){n(a.target,"error"===a.type)}function n(b,c){b.src!==h&&-1===a.inArray(b,i)&&(i.push(b),c?k.push(b):j.push(b),a.data(b,"imagesLoaded",{isBroken:c,src:b.src}),f&&e.notifyWith(a(b),[c,g,a(j),a(k)]),g.length===i.length&&(setTimeout(l),g.unbind(".imagesLoaded",m)))}var c=this,e=a.isFunction(a.Deferred)?a.Deferred():0,f=a.isFunction(e.notify),g=c.find("img").add(c.filter("img")),i=[],j=[],k=[];return a.isPlainObject(b)&&a.each(b,function(a,c){"callback"===a?b=c:e&&e[a](c)}),g.length?g.bind("load.imagesLoaded error.imagesLoaded",m).each(function(b,c){var e=c.src,f=a.data(c,"imagesLoaded");return f&&f.src===e?(n(c,f.isBroken),void 0):c.complete&&c.naturalWidth!==d?(n(c,0===c.naturalWidth||0===c.naturalHeight),void 0):((c.readyState||c.complete)&&(c.src=h,c.src=e),void 0)}):l(),e?e.promise(c):c};var j,m,n,i=a.event,k={_:0},l=0;j=i.special.throttledresize={setup:function(){a(this).on("resize",j.handler)},teardown:function(){a(this).off("resize",j.handler)},handler:function(b,c){var d=this,e=arguments;m=!0,n||(setInterval(function(){l++,(l>j.threshold&&m||c)&&(b.type="throttledresize",i.dispatch.apply(d,e),m=!1,l=0),l>9&&(a(k).stop(),n=!1,l=0)},30),n=!0)},threshold:0}}(jQuery,window,document),jQuery(document).ready(function(a){jQuery(".cq-tumblr-photoset").each(function(){var c=jQuery(this).data("galleryid");jQuery(this).photosetGrid({highresLinks:"none"==jQuery(this).data("largeimageas")?!1:!0,rel:jQuery(this).data("galleryid"),gutter:jQuery(this).data("gutter")+"px",lowresWidth:""==jQuery(this).data("miniwidth")?500:jQuery(this).data("miniwidth"),onComplete:function(){a("#"+c).attr("style",""),"lightbox"==a("#"+c).data("largeimageas")&&a("#"+c+" a").colorbox({photo:!0,fixed:!0,slideshow:a("#"+c).data("slideshow"),slideshowSpeed:a("#"+c).data("delay"),scalePhotos:!0,maxHeight:"90%",maxWidth:"90%"})}})})});