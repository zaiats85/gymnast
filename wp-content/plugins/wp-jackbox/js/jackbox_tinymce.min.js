;(function(d){function S(a){ja();if(a)q.onNodeChange.add(ka);else q.on("NodeChange",ka)}function ja(){var a=d("#content_ifr");if(a.length)a.one("load.jackbox",wa);else la++,25>la&&setTimeout(ja,50)}function wa(){var a=d(this),a=a.contents();a.length&&(a=a.find("head"),a.length&&d("<style />").html("a.jackbox, a.jackbox:visited {background-color: #e5e5e5} .jackbox img {padding: 6px; margin: 0; background-color: #e5e5e5}").appendTo(a))}function ka(a,b,c){l||(a=a.target,c=a.selection.getNode(),b=a.controlManager); a=d(c);c=c.nodeName.toLowerCase();D=b;"a"===c||"img"===c?(l?b.setDisabled("jackbox",!1):I.disabled(!1),"img"===c&&(a=a.closest("a"))):l?b.setDisabled("jackbox",!0):I.disabled(!0);a.attr("class")?-1!==a.attr("class").search("jackbox")?l?b.setDisabled("jackbox_remove",!1):y.disabled(!1):l?b.setDisabled("jackbox_remove",!0):y.disabled(!0):l?b.setDisabled("jackbox_remove",!0):y.disabled(!0)}function xa(){t.execCommand("mceCodeEditor")}function ya(){u.execCommand("mceCodeEditor")}function za(){E||(E=d(T).appendTo(d("body")), l||E.addClass("jb-modern-tiny"),U=d(".jackbox-cover").click(V),e=d(U.find("form")).submit(Aa),e.find("input[type=text], textarea"),ma=e.find("input[type=text], input[type=radio], textarea, select"),na=d(window),p=e.find(".jb-extras"),W=e.find(".jb-category"),J=e.find("select[name=data-jbhover]"),oa=U.find("h2")[0],v=e.find(".jb-multimedia"),F=e.find("input[name=data-jbtitle]"),e.find("textarea[name=data-jbhtml]"),w=e.find(".jb-media-holder").hide(),K=e.find(".jb-thumb-holder").hide(),L=e.find(".jb-poster-holder").hide(), T=d(".jackbox-container").click(Ba),pa=d(".jackbox-edit-raw-desc").click(ya),X=d(".jackbox-edit-raw").click(xa).hide(),x=d(".jb-inline").children("input").change(Ca),s=e.find("input[name=data-jbgroup]").keyup(Da),Y=e.find("input[name=data-jbposter]").focusin(Z).focusout($),r=e.find("input[name=data-jbhref]").data("jbType",1).focusin(Z).focusout($),aa=e.find("input[name=data-jbthumbnail]").data("jbType",2).focusin(Z).focusout($),qa=!!document.createElement("video").canPlayType,ra=-1===navigator.userAgent.toLowerCase().search("msie")&& !!document.createElement("video").canPlayType,m=[],d(".jackbox-addmedia").click(sa),d(".jackbox-close").click(V),d(".jackbox-small").keyup(Ea),ba=e.find(".jackbox-scale-no"),ca=e.find(".jackbox-scale-yes"),M=e.find(".jackbox-scale-default"),da=e.find(".jackbox-autoplay-no"),ea=e.find(".jackbox-autoplay-yes"),N=e.find(".jackbox-autoplay-default"),fa=e.find(".jackbox-flash-no"),ga=e.find(".jackbox-flash-yes"),O=e.find(".jackbox-flash-default"),ha=e.find(".jackbox-hidden-yes"),P=e.find(".jackbox-hidden-no"), l?(tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-desc"),tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-html"),u=tinyMCE.getInstanceById("jb-tiny-desc"),t=tinyMCE.getInstanceById("jb-tiny-html")):(u=new tinyMCE.Editor("jb-tiny-desc",{plugins:"code"},tinyMCE.EditorManager),t=new tinyMCE.Editor("jb-tiny-html",{plugins:"code"},tinyMCE.EditorManager),u.render(),t.render()),d("#jb-tiny-desc_ifr").css("background-color","#FFF"),z=d("#jb-tiny-html_ifr").css({backgroundColor:"#FFF",height:215}).hide(), l?(d("#jb-tiny-desc_parent").css({display:"block",top:12,clear:"both"}).find(".mce_jackbox, .mce_jackbox_remove").remove(),A=d("#jb-tiny-html_parent")):(pa.parent().find(".mce-tinymce").css({display:"block",top:12,clear:"both"}).find(".mce_jackbox, .mce_jackbox_remove").remove(),A=x.parent().parent().find(".mce-tinymce")),A.css({display:"block",top:12,clear:"both"}).hide().find(".mce_jackbox, .mce_jackbox_remove").remove(),Array.prototype.indexOf||(Array.prototype.indexOf=Fa),"undefined"===typeof B&& (B=!(wp&&wp.media&&wp.media.editor&&wp.media.editor.send&&wp.media.editor.send.attachment)));B?(Q=window.send_to_editor,window.send_to_editor=ta):(Q=wp.media.editor.send.attachment,wp.media.editor.send.attachment=ta);q=l?tinyMCE.getInstanceById("content"):tinyMCE.get("content");n=q.selection;l?(D=q.controlManager,D.setDisabled("jackbox",!0),D.setDisabled("jackbox_remove",!0)):(I.disabled(!0),y.disabled(!0));var a=n.select(n.getNode()),b,c;h=d(a);h.is("img")&&(a=h.closest("a"),a.is("a")&&(h=a),c=!0); N.attr("checked","checked");M.attr("checked","checked");O.attr("checked","checked");P.attr("checked","checked");J[0].selectedIndex=0;try{u.setContent("")}catch(f){}d("#wp_editbtns").hide();if(h.is("a")){if(h.hasClass("jackbox"))for(a=ua.length;a--;){if(b=ua[a],h.attr(b))a:{c=b;b=h.attr(b);var k=void 0,g=void 0;if(-1!==c.search("data-jb")){g=c.split("data-jb")[1];switch(g){case "title":e.find("input[name="+c+"]").val(unescape(b));break a;case "description":u.setContent(unescape(b));break a;case "hover":k= e.find("select[name="+c+"]");break;case "html":x[0].checked=!0;x.trigger("change");t.setContent(unescape(b));break a;default:k=e.find("input[name="+c+"]")}if(k.length)if("radio"!==k.attr("type"))switch(g){case "thumbnail":k.val(b);C(b,K);break;case "hover":if(c=b.match(Ga))J[0].selectedIndex=J.find("option[value="+c+"]").index();break;case "poster":k.val(b);C(b,L);break;case "group":k.val(unescape(b));break;default:k.val(b)}else switch(g){case "scaleup":"no"===b?(ca.removeAttr("checked"),M.removeAttr("checked"), ba.attr("checked","checked")):"yes"===b&&(ba.removeAttr("checked"),M.removeAttr("checked"),ca.attr("checked","checked"));break;case "autoplay":"no"===b?(ea.removeAttr("checked"),N.removeAttr("checked"),da.attr("checked","checked")):"yes"===b&&(da.removeAttr("checked"),N.removeAttr("checked"),ea.attr("checked","checked"));break;case "hiddenitem":"no"===b?(ha.removeAttr("checked"),P.attr("checked","checked")):"yes"===b&&(P.removeAttr("checked"),ha.attr("checked","checked"));break;case "flashhaspriority":"no"=== b?(ga.removeAttr("checked"),O.removeAttr("checked"),fa.attr("checked","checked")):"yes"===b&&(fa.removeAttr("checked"),O.removeAttr("checked"),ga.attr("checked","checked"))}}else"href"===c&&(r.val(b),C(b,w))}}else{if(a=h.attr("href"))r.val(a),C(a,w);h.attr("title")&&F.val(h.attr("title"))}a=h.children("img");a.length&&a.attr("alt")&&F.val(a.attr("alt"))}else c?c&&h.attr("alt")&&F.val(h.attr("alt")):(c=h.children("img"),c.length&&c.attr("alt")&&(F.val(c.attr("alt")),h=c));c=q.getContent({format:"raw"}); b=(k=c.match(/data-jbgroup="/g))?k.length:0;for(a=0;a<b;a++){g=c.indexOf('data-jbgroup="');for(k=g+15;'"'!==c.charAt(k);)k++;g=c.substring(g+14,k);-1===m.indexOf(unescape(g))&&(m[m.length]=unescape(g));c=c.substr(k,c.length)}if(m.length){b=m.length;k={type:"checkbox"};for(a=0;a<b;a++)c=unescape(m[a]),k.name="jb-"+c.split(" ").join("-"),d("<input />").attr(k).change(Ha).appendTo(p),d("<span />").text(" "+c).appendTo(p),d("<br />").appendTo(p);p.show();W.addClass("jb-noborder");s.val()?(a=m.indexOf(s.val()), -1!==a&&p.children("input[name=jb-"+unescape(m[a]).split(" ").join("-")+"]").attr("checked","checked")):(s.val(unescape(m[0])),p.children("input[name=jb-"+unescape(m[0]).split(" ").join("-")+"]").attr("checked","checked"))}E.stop(!0,!0).fadeIn(300);T.scrollTop(0);n.collapse()}function Ha(){if(this.checked)for(var a=p.children("input"),b=a.length,c;b--;)c=d(a[b]),c[0]!==this?c.removeAttr("checked"):(c.attr("checked","checked"),c=c.next().text(),s.val(c.substring(1,c.length)));else s.val("")}function Da(){var a= m.indexOf(this.value);-1===a?p.children("input").each(Ia):p.children("input[name=jb-"+m[a].split(" ").join("-")+"]").attr("checked","checked")}function Ia(){d(this).removeAttr("checked")}function Aa(a){a.preventDefault();if(window.confirm("Submit Changes?")){a=!0;G=x[0].checked;s.val()||(s.addClass("jb-error").one("focusin",ia),a=!1);if(G)t.getContent()||(z.addClass("jb-error").one("click",ia),a=!1);else{var b=r.val();b&&"#"!==b||(r.addClass("jb-error").one("focusin",ia),a=!1)}a?(g=d("<a />"),h.attr("class")&& g.attr("class",h.attr("class")),g.removeClass("jackbox-hidden-item").addClass("jackbox"),h.is("a")?(a=h.children("img"),a.length?(a.unwrap(),g.append(a)):(g.html(h.html()),n.select(h[0]))):g.append(h),ma.each(Ja),n.setNode(g[0]),V()):oa.scrollIntoView()}}function Ja(){var a=d(this),b=a.attr("name"),c=a.attr("type"),f=a.val(),k=b.split("data-jb")[1];if("href"===k){if(G||!f)f="#";g.attr("href",f)}else{var e="description"===k;if(e||"html"===k){if(e)f=u.getContent();else if(G)f=t.getContent();else return; f&&g.attr(b,escape(f))}else if(f&&"checkbox"!==c)if("radio"!==c){if("hover"!==k||"default"!==f){if("title"===k||"group"===k)f=escape(f);g.attr(b,f)}}else if(a.attr("checked"))switch(a=a.attr("class").split("jackbox-").join(""),k){case "scaleup":"scale-yes"===a?g.attr(b,"yes"):"scale-no"===a?g.attr(b,"no"):g.removeAttr(b);break;case "autoplay":"autoplay-yes"===a?g.attr(b,"yes"):"autoplay-no"===a?g.attr(b,"no"):g.removeAttr(b);break;case "hiddenitem":"hidden-yes"===a&&(g.attr(b,"yes"),g.addClass("jackbox-hidden-item")); break;case "flashhaspriority":"flash-yes"===a?g.attr(b,"yes"):"flash-no"===a?g.attr(b,"no"):g.removeAttr(b)}}}function V(a){if(!a||window.confirm("Exit without Saving?"))E.stop(!0,!0).fadeOut(300),e.find("input[type=text], textarea").val(""),W.removeClass("jb-noborder"),m=[],G=!1,p.empty().hide(),w.empty().hide(),K.empty().hide(),L.empty().hide(),Y.removeData("jborig"),x.removeAttr("checked"),aa.removeData("jborig"),s.removeClass("jb-error"),v.removeClass("jb-loading"),x.removeData("jbhasmedia"), r.removeData("jborig").removeClass("jb-error").show(),z.removeClass("jb-error").hide(),u.setContent(""),t.setContent(""),A.hide(),v.show(),B?window.send_to_editor=Q:wp.media.editor.send.attachment=Q,na.scrollTop(0)}function Ba(a){a.stopImmediatePropagation()}function sa(){var a=d(this),b;!a.hasClass("jackbox-addmedia")&&a.is("img")&&(a=a.parent().parent().find(".jackbox-addmedia"));b=a.parent();b.hasClass("jb-multimedia")&&(b=b.parent());va=b.find("input[type=text]").data("jbType");B?tb_show("","media-upload.php?type=image&amp;TB_iframe=true"): (wp.media.editor.open(a),d(".media-menu").children(":eq(1)").hide())}function ta(a,b){var c,f;B?(c=d(a),c=c.attr("src")||c.attr("href"),tb_remove()):c=b.url;switch(va){case 1:input=r;f=w;break;case 2:input=aa;f=K;break;default:input=Y,f=L}input.val(c);C(c,f)}function Z(){var a=d(this),b=a.val();b&&a.data("jborig",b)}function $(){var a=d(this),b=a.val();b!==a.data("jborig")&&C(b,d(this).parent().children(".jb-media"))}function C(a,b){var c=Ka(a);b.empty().hide();if(c){var f;"vimeo"!==c?-1!==c.search("mp4")? ra?(f=d("<video />").attr("controls","controls").appendTo(b.show()),d("<source />").attr({type:"video/webm",src:c.split("mp4").join("webm")}).appendTo(f),d("<source />").attr({type:"video/mp4",src:c}).appendTo(f)):(f=d("<img />").one("load.jackbox",R).appendTo(b),f.attr("src",H+"../img/video.jpg")):-1!==c.search("mp3")?qa?(f=d("<audio />").attr("controls","controls").appendTo(b.show()),d("<source />").attr({type:"audio/ogg",src:c.split("mp3").join("ogg")}).appendTo(f),d("<source />").attr({type:"audio/mpeg", src:c}).appendTo(f)):(f=d("<img />").one("load.jackbox",R).appendTo(b),f.attr("src",H+"../img/audio.jpg")):(v.addClass("jb-loading"),f=d("<img />").one("load.jackbox",R).one("error.jackbox",La).appendTo(b),f.attr("src",c)):(f=d("<img />").one("load.jackbox",R).appendTo(b),d.getJSON("http://vimeo.com/api/v2/video/"+a.split("https").join("http").split("http://vimeo.com/")[1]+".json?callback=?",{format:"json"},function(a){f.attr("src",a[0].thumbnail_small)}))}}function La(){v.removeClass("jb-loading"); d(this).unbind("load.jackbox")}function Ka(a){if(-1!==a.search("youtube"))return"http://img.youtube.com/vi/"+a.split("http://www.youtube.com/watch?v=")[1]+"/1.jpg";if(-1!==a.search("vimeo"))return"vimeo";var b=a.split(".");if(!b.length)return null;b=b[b.length-1];return"jpg"===b||"png"===b||"gif"===b||"mp4"===b||"mp3"===b?a:null}function R(){var a=d(this).unbind("error.jackbox");v.removeClass("jb-loading");a.parent().show();var b=this.width||a.width(),c=this.height||a.height(),f=75<c?75/c:1;223<b* f&&(f=223/b);a.attr({width:b*f,height:c*f}).click(sa)}function Ca(){var a=d(this);this.checked?(""!==w.html()&&(a.data("jbhasmedia",!0),w.hide()),v.hide(),r.hide(),A.show(),z.show(),X.show()):(z.hide(),A.hide(),X.hide(),v.show(),r.show(),a.data("jbhasmedia")&&(a.removeData("jbhasmedia"),w.show()));r.removeClass("jb-error");z.removeClass("jb-error")}function Fa(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1}function Ea(){this.value=this.value.replace(Ma,"")}function ia(){d(this).removeClass("jb-error")} function Na(){n=d(q.selection.getNode());n.is("img")&&(n=n.parent());n.removeClass("jackbox jackbox-hidden-item");l?D.setDisabled("jackbox_remove",!0):y.disabled(!0);for(var a=n[0].attributes,b=a.length,c;b--;)c=a[b].name,-1!==c.search("data-jb")&&n.removeAttr(c)}var g,na,m,h,Q,H,e,J,U,E,r,v,F,p,q,ma,Y,da,oa,B,pa,x,s,va,fa,ba,ea,N,D,qa,ra,X,W,ca,M,ga,O,A,t,u,P,ha,G,n,aa,z,I,l,w,K,y,L,la=0,Ma=/[^0-9\.|#|-]/g,Ga=/none|black-magnify|black-play|black-document|white-magnify|white-play|white-document|blur-magnify|blur-play|blur-document/g, ua="href data-jbgroup data-jbhref data-jbtitle data-jbdescription data-jbwidth data-jbheight data-jbthumbnail data-jbthumbtooltip data-jbhover data-jbscaleup data-jbautoplay data-jbflashhaspriority data-jbposter data-jbaudiotitle data-jbhiddenitem data-jbhtml".split(" "),T='<div class="jackbox-modal"><div class="jackbox-cover"><div class="jackbox-container"><span class="jackbox-close button">x</span><div class="jackbox-content"><h2>'+jackboxTranslate.jb_1+'</h2><hr /><form class="jackbox-form" method="post" enctype="text/plain"><h3>'+ jackboxTranslate.jb_2+'</h3><hr /><p class="jb-category">'+jackboxTranslate.jb_3+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_4+'">?</span><br /><input class="jackbox-medium" name="data-jbgroup" type="text" /></p><p class="jb-extras"></p><hr /><p><span class="jb-multimedia">'+jackboxTranslate.jb_5+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_6+'">?</span></span><span class="jackbox-edit-raw button">'+ jackboxTranslate.jb_47+'</span><span class="jb-inline">'+jackboxTranslate.jb_7+'<span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_8+'">?</span><input type="checkbox" name="data-jbcontent" /></span><input name="data-jbhref" type="text" /><textarea id="jb-tiny-html" name="data-jbhtml"></textarea><span class="jb-media jb-media-holder"></span></p><hr /><h3>'+jackboxTranslate.jb_9+"</h3><hr /><p>"+jackboxTranslate.jb_10+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_11+ '">?</span><br /><input class="jackbox-medium" name="data-jbtitle" type="text" /></p><hr /><p><span class="jackbox-edit-raw-desc button">'+jackboxTranslate.jb_47+"</span>"+jackboxTranslate.jb_12+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_13+'">?</span><br /><textarea id="jb-tiny-desc" name="data-jbdescription"></textarea></p><hr /><div><p>'+jackboxTranslate.jb_14+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_15+'">?</span><br /><input class="jackbox-small" name="data-jbwidth" type="text" /></p><p>'+ jackboxTranslate.jb_16+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_17+'">?</span><br /><input class="jackbox-small" name="data-jbheight" type="text" /></p></div><hr /><p>'+jackboxTranslate.jb_18+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_19+'">?</span><br /><span class="jackbox-box"><input class="jackbox-scale-yes" name="data-jbscaleup" type="radio" value="true" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-scale-no" name="data-jbscaleup" type="radio" value="false" /> '+ jackboxTranslate.jb_no+' <input class="jackbox-scale-default" name="data-jbscaleup" type="radio" value="default" /> '+jackboxTranslate.jb_default+"</span></p><hr /><p>"+jackboxTranslate.jb_20+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_21+'">?</span><br /><select name="data-jbhover"><option value="default" selected>'+jackboxTranslate.jb_default+'</option><option value="none">'+jackboxTranslate.jb_22+'</option><option value="black-magnify">'+jackboxTranslate.jb_23+'</option><option value="black-play">'+ jackboxTranslate.jb_24+'</option><option value="black-document">'+jackboxTranslate.jb_25+'</option><option value="white-magnify">'+jackboxTranslate.jb_26+'</option><option value="white-play">'+jackboxTranslate.jb_27+'</option><option value="white-document">'+jackboxTranslate.jb_28+'</option><option value="blur-magnify">'+jackboxTranslate.jb_29+'</option><option value="blur-play">'+jackboxTranslate.jb_30+'</option><option value="blur-document">'+jackboxTranslate.jb_31+"</option></select></p><hr /><p>"+ jackboxTranslate.jb_32+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_33+'">?</span><br /><input name="data-jbthumbnail" type="text" /><br /><span class="jb-media jb-thumb-holder"></span></p><hr /><p>'+jackboxTranslate.jb_34+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_35+'">?</span><br /><input class="jackbox-medium" name="data-jbthumbtooltip" type="text" /></p><hr /><div><p>'+jackboxTranslate.jb_36+ ' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_37+'">?</span><br /><span class="jackbox-box"><input class="jackbox-autoplay-yes" name="data-jbautoplay" type="radio" value="true" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-autoplay-no" name="data-jbautoplay" type="radio" value="false" /> '+jackboxTranslate.jb_no+' <input class="jackbox-autoplay-default" name="data-jbautoplay" type="radio" value="default" /> '+jackboxTranslate.jb_default+"</span></p><p>"+jackboxTranslate.jb_38+ ' <span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_39+'">?</span><br /><span class="jackbox-box"><input class="jackbox-flash-yes" name="data-jbflashhaspriority" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-flash-no" name="data-jbflashhaspriority" type="radio" value="true" /> '+jackboxTranslate.jb_no+' <input class="jackbox-flash-default" name="data-jbflashhaspriority" type="radio" value="default" /> '+jackboxTranslate.jb_default+"</p></div><hr /><p>"+ jackboxTranslate.jb_40+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_41+'">?</span><br /><input name="data-jbposter" type="text" /><br /><span class="jb-media jb-poster-holder"></span></p><hr /><p>'+jackboxTranslate.jb_42+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_43+'">?</span><br /><input class="jackbox-medium" name="data-jbaudiotitle" type="text" /></p><hr /><p>'+jackboxTranslate.jb_44+ ' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_45+'">?</span><br /><span class="jackbox-box"><input class="jackbox-hidden-yes" name="data-jbhiddenitem" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-hidden-no" name="data-jbhiddenitem" type="radio" value="true" /> '+jackboxTranslate.jb_no+'</span></p><hr /><p class="submit_jb"><input type="submit" class="button-primary" value="'+jackboxTranslate.jb_46+'" /></p></form></div></div></div></div>';tinymce.create("tinymce.plugins.jackbox", {init:function(a,b){q=a;H=b+"/";l="getInstanceById"in tinyMCE;var c,d,e,g={title:"Add/Edit JackBox",image:H+"../img/jackbox.png",onclick:za},h={title:"Remove JackBox",image:H+"../img/jackbox_remove.png",onclick:Na};l||(g.onPostRender=function(){I=this;c=!0;d&&!e&&(e=!0,S())},h.onPostRender=function(){y=this;d=!0;c&&!e&&(e=!0,S())});q.addButton("jackbox",g);q.addButton("jackbox_remove",h);l&&S(!0)}});tinymce.PluginManager.add("jackbox",tinymce.plugins.jackbox)})(jQuery);